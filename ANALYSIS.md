# Огляд застосунку «Облік закупівель»

## 1. Загальна архітектура
- **Фреймворк:** чистий HTML/CSS/JS без збирача. Запуск здійснюється через статичний сервер (`npx serve . -p 3000`).【F:package.json†L1-L27】
- **Головна сторінка:** містить основні екрани (головна панель, списки закупівель/відвантажень, форма, звіти) та значний обсяг бізнес-логіки вбудовано безпосередньо в `index.html` у вигляді скрипту.【F:index.html†L32-L714】
- **Додаткові модулі:** окремі файли `app.js`, `styles.css`, `service-worker.js`, `manifest.json`, але на практиці браузер використовує inline-скрипт з HTML, тоді як `app.js` не підключено тега `<script>` і містить іншу, більш захищену реалізацію.【F:index.html†L219-L714】【F:app.js†L1-L1030】

## 2. Ключовий функціонал
- **Управління екраном:** клас `AppState` перемикає між головним екраном та формою, а також табами нижньої навігації.【F:index.html†L228-L355】
- **Збір даних:** форма дозволяє фіксувати закупівлі, відвантаження та доставки з фото, кількістю, ціною, локацією та одиницями виміру.【F:index.html†L124-L183】
- **Локальне збереження:** inline-реалізація зберігає записи у `localStorage` та підтримує редагування/видалення.【F:index.html†L282-L503】【F:index.html†L610-L671】
- **Пакетна відправка:** функція `sendAllToServer` формує `FormData` (з можливим фото) і відправляє всі записи на webhook з тайм-аутом і паузою між запитами.【F:index.html†L524-L606】
- **Аналітика:** розділ «Звіти» рахує суму витрат та кількість операцій, будує діаграму Doughnut за допомогою Chart.js.【F:index.html†L673-L699】

## 3. PWA та офлайн-можливості
- **Маніфест:** визначає назву, кольори теми, стартовий URL і SVG-іконки, орієнтований на портретний режим.【F:manifest.json†L1-L25】
- **Service Worker:** попередньо кешує статичні ресурси (включно з `app.js`) і застосовує стратегії `networkFirst` для HTML та `cacheFirst` для інших GET-запитів, підтримуючи офлайн-роботу і швидке оновлення через `SKIP_WAITING`.【F:service-worker.js†L1-L83】

## 4. Безпека та продуктивність
- **Inline-версія:** мінімальна санітизація; введення надсилається майже без перевірок, а фото перетворюється у base64 без контролю розміру/типу, що створює ризики для стабільності та безпеки.【F:index.html†L468-L575】
- **Окремий `app.js`:** містить розширену валідацію (обмеження довжини, whitelist MIME, санітизація), безпечну роботу з API (тайм-аути, запасний webhook), кешування UI через `requestAnimationFrame`, чергу тостів та можливість отримувати AI-звіт через Gemini API.【F:app.js†L4-L406】【F:app.js†L419-L870】
- **Теми та UI:** стилі використовують «glassmorphism» та темну тему через CSS-змінні, що зберігаються у `localStorage`.【F:styles.css†L1-L82】

## 5. Зовнішні інтеграції
- **n8n webhook:** URL береться з конфігурації; inline-варіант жорстко вказує зовнішню адресу (`https://n8n.dmytrotovstytskyi.online/webhook/delivery`), тоді як `SecureConfig` у `app.js` очікує використання проксі `/api/delivery` або перевизначення через глобальну змінну, що зручніше для середовищ із різними доменами.【F:index.html†L265-L279】【F:app.js†L49-L91】
- **Gemini AI:** розширена версія в `app.js` генерує кінцевий звіт за день, але функція вимкнена без API-ключа і не має UI-підключення в поточному HTML.【F:app.js†L306-L947】

## 6. Виявлені невідповідності та потенційні проблеми
1. **Дублювання логіки:** `app.js` і inline-скрипт реалізують схожі, але різні сценарії (наприклад, `sessionStorage` проти `localStorage`, різні схеми вкладок). Оскільки `app.js` не підключений, користувачі отримують менш захищений варіант, а оновлення в `app.js` не впливають на UI.【F:index.html†L282-L714】【F:app.js†L181-L221】
2. **Непогоджені селектори:** `app.js` очікує елементи `purchasesTab` / `historyTab`, які відсутні в HTML (використовуються `purchasesListTab` та `unloadingListTab`), що ускладнить інтеграцію покращеної логіки без правок розмітки.【F:app.js†L154-L162】【F:index.html†L67-L121】
3. **Формат збереження:** inline-версія зберігає записи у `localStorage` без валідації схеми, тоді як `app.js` переходить на `sessionStorage` і перевіряє поля, тому перехід між реалізаціями може призвести до втрати або несумісності даних.【F:index.html†L282-L299】【F:app.js†L181-L213】
4. **Безпека файлів:** обробка фото у inline-варіанті не перевіряє тип/розмір, що може спричинити великі завантаження та витрати пам'яті; поліпшена перевірка існує тільки в `app.js`.【F:index.html†L468-L575】【F:app.js†L40-L45】
5. **Документація vs реальність:** README стверджує, що JS винесено в окремий файл, але фактично значний код залишився в HTML; це ускладнює підтримку і порушує задекларовані покращення.【F:README.md†L16-L29】【F:index.html†L219-L714】

## 7. Рекомендації
- **Уніфікувати логіку:** підключити `app.js` у `index.html`, адаптувати DOM та видалити застарілий inline-код, щоб активувати більш безпечну реалізацію.
- **Зберігання даних:** обрати єдине сховище (`localStorage` або `sessionStorage`) з валідацією схем та міграцією існуючих записів.
- **Конфігурація інтеграцій:** винести URL webhook та ключі у змінні середовища/конфігураційні файли, передбачити UI для AI-звіту.
- **Безпека користувача:** додати контроль обсягу/типу вкладених файлів у чинну реалізацію та розширити повідомлення про помилки для полегшення виправлення введення.
- **Документація:** оновити README відповідно до фактичної структури або завершити обіцяне розділення коду.
main
